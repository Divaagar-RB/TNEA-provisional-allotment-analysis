<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üéÆ NEON TNEA CUTOFF DASHBOARD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', monospace;
            background: #0a0a0a;
            color: #00ff88;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background Grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0,255,136,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,255,136,0.1) 1px, transparent 1px),
                radial-gradient(circle at 25% 25%, rgba(255,0,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(0,255,255,0.1) 0%, transparent 50%);
            background-size: 50px 50px, 50px 50px, 100% 100%, 100% 100%;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Scanline Effect */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(0,255,255,0.8), transparent);
            animation: scanline 3s linear infinite;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes scanline {
            0% { transform: translateY(-4px); }
            100% { transform: translateY(100vh); }
        }

        h1 {
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            font-size: 3.5rem;
            text-align: center;
            margin: 40px 0;
            color: #00ffff;
            text-shadow: 
                0 0 5px #00ffff,
                0 0 10px #00ffff,
                0 0 15px #00ffff,
                0 0 20px #00ffff;
            animation: titlePulse 2s ease-in-out infinite alternate;
            position: relative;
        }

        h1::after {
            content: '‚ñÆ';
            animation: blink 1s infinite;
            color: #ff00ff;
        }

        @keyframes titlePulse {
            0% { text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff, 0 0 15px #00ffff; }
            100% { text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff, 0 0 30px #00ffff, 0 0 40px #00ffff; }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .chart-container {
            background: rgba(0,0,0,0.8);
            border: 2px solid;
            border-radius: 15px;
            margin: 30px 0;
            padding: 30px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            
            border-radius: 15px;
            z-index: -1;
            animation: borderRotate 3s linear infinite;
        }

        

        .chart-container:nth-child(2) { border-color: #00ffff; }
        .chart-container:nth-child(3) { border-color: #ff00ff; }
        .chart-container:nth-child(4) { border-color: #ffff00; }
        .chart-container:nth-child(5) { border-color: #00ff88; }
        .chart-container:nth-child(6) { border-color: #ff6600; }

        .chart-container:hover {
            transform: translateY(-10px);
            box-shadow: 
                0 20px 40px rgba(0,255,255,0.3),
                0 0 60px rgba(255,0,255,0.2);
        }

        h2 {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .chart-container:nth-child(2) h2 { 
            color: #00ffff; 
            text-shadow: 0 0 10px #00ffff;
        }
        .chart-container:nth-child(3) h2 { 
            color: #ff00ff; 
            text-shadow: 0 0 10px #ff00ff;
        }
        .chart-container:nth-child(4) h2 { 
            color: #ffff00; 
            text-shadow: 0 0 10px #ffff00;
        }
        .chart-container:nth-child(5) h2 { 
            color: #00ff88; 
            text-shadow: 0 0 10px #00ff88;
        }
        .chart-container:nth-child(6) h2 { 
            color: #ff6600; 
            text-shadow: 0 0 10px #ff6600;
        }

        canvas {
            background: rgba(0,0,0,0.5) !important;
            border-radius: 10px;
            box-shadow: inset 0 0 20px rgba(0,255,255,0.1);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.2rem;
            color: #00ffff;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0,255,255,0.1);
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            text-align: center;
            color: #ff0040;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 0 10px #ff0040;
            padding: 40px;
        }

        .error::before {
            content: '‚ö† SYSTEM ERROR ‚ö†\A';
            white-space: pre;
            display: block;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .insight-card {
            background: rgba(0,0,0,0.7);
            border: 1px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .insight-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: scan 2s ease-in-out infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        .insight-card:hover {
            border-color: #ff00ff;
            box-shadow: 0 0 20px rgba(0,255,255,0.3);
            transform: scale(1.05);
        }

        .insight-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            color: #ffff00;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #ffff00;
        }

        .insight-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .chart-container {
                margin: 20px 0;
                padding: 20px;
            }
            
            .container {
                padding: 0 10px;
            }
        }

        /* Click Effect */
        .click-effect {
            position: absolute;
            pointer-events: none;
            width: 100px;
            height: 100px;
            border: 2px solid #00ffff;
            border-radius: 50%;
            animation: clickRipple 0.6s ease-out;
        }

        @keyframes clickRipple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° NEURAL TNEA PROTOCOL ‚ö°</h1>

        <div class="chart-container">
            <h2>üéØ Institution Node Analysis</h2>
            <canvas id="areaTypeChart"></canvas>
        </div>

        <div class="chart-container">
            <h2>üåê Zone Network Status</h2>
            <canvas id="zoneChart"></canvas>
        </div>

        <div class="chart-container">
            <h2>üìä District Command Centers</h2>
            <canvas id="districtChart"></canvas>
        </div>

        <div class="chart-container">
            <h2>üèÜ Elite Districts Leaderboard</h2>
            <canvas id="topDistrictChart"></canvas>
        </div>

        <div class="chart-container">
            <h2>üìà Temporal Flux Analysis</h2>
            <canvas id="districtTrendChart"></canvas>
        </div>

        <div class="insights-grid">
            <div class="insight-card">
                <div class="insight-title">TOTAL ZONES</div>
                <div class="insight-value" id="totalZones">--</div>
            </div>
            <div class="insight-card">
                <div class="insight-title">ACTIVE DISTRICTS</div>
                <div class="insight-value" id="totalDistricts">--</div>
            </div>
            <div class="insight-card">
                <div class="insight-title">HIGHEST CUTOFF</div>
                <div class="insight-value" id="maxCutoff">--</div>
            </div>
            <div class="insight-card">
                <div class="insight-title">SYSTEM STATUS</div>
                <div class="insight-value" style="color: #00ff00;">ONLINE</div>
            </div>
        </div>

       
    </div>

    <script>
        // Click effect
        document.addEventListener('click', function(e) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.style.left = e.clientX - 50 + 'px';
            effect.style.top = e.clientY - 50 + 'px';
            document.body.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 600);
        });

        // Mock data for demonstration (replace with your API call)
        async function fetchRegionalData() {
    try {
        const response = await fetch('/cutoff/regional-data'); // Your Flask endpoint
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();
        return data;
    } catch (err) {
        console.error('üí• Fetch failed:', err);
        throw err;
    }
}


        function createLoadingElement() {
            const loading = document.createElement('div');
            loading.className = 'loading';
            loading.innerHTML = '<div class="spinner"></div>LOADING NEURAL DATA...';
            return loading;
        }

        function renderBarChart(ctx, labels, datasets, title, neonColor) {
            new Chart(ctx, {
                type: 'bar',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    plugins: {
                        title: { 
                            display: false
                        },
                        legend: { 
                            position: 'top',
                            labels: {
                                color: neonColor,
                                font: {
                                    family: 'Rajdhani',
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: { 
                            mode: 'index', 
                            intersect: false,
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: neonColor,
                            bodyColor: '#ffffff',
                            borderColor: neonColor,
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,255,255,0.1)'
                            },
                            ticks: {
                                color: neonColor,
                                font: {
                                    family: 'Rajdhani'
                                }
                            },
                            title: { 
                                display: true, 
                                text: 'CUTOFF SCORE',
                                color: neonColor,
                                font: {
                                    family: 'Orbitron',
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        x: { 
                            grid: {
                                color: 'rgba(0,255,255,0.1)'
                            },
                            ticks: {
                                color: neonColor,
                                font: {
                                    family: 'Rajdhani'
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderLineChart(ctx, labels, datasets, neonColor) {
            new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { 
                            position: 'top',
                            labels: {
                                color: neonColor,
                                font: {
                                    family: 'Rajdhani',
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: { 
                            mode: 'index', 
                            intersect: false,
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: neonColor,
                            bodyColor: '#ffffff',
                            borderColor: neonColor,
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const idx = context.dataIndex;
                                    const row = mockData.district_data[idx];
                                    const year = context.dataset.label;
                                    const cutoff = row[`avg_${year}`].toFixed(2);
                                    const trendSymbol = row.trend === 'increasing' ? '‚Üë' :
                                                        row.trend === 'decreasing' ? '‚Üì' : '‚Üí';
                                    return ` ${year}: ${cutoff} (${trendSymbol}, Vol: ${row.volatility.toFixed(2)})`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255,102,0,0.1)'
                            },
                            ticks: {
                                color: neonColor,
                                font: {
                                    family: 'Rajdhani'
                                }
                            },
                            title: { 
                                display: true, 
                                text: 'CUTOFF TRAJECTORY',
                                color: neonColor,
                                font: {
                                    family: 'Orbitron',
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        x: { 
                            grid: {
                                color: 'rgba(255,102,0,0.1)'
                            },
                            ticks: {
                                color: neonColor,
                                font: {
                                    family: 'Rajdhani'
                                },
                                maxRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function prepareDatasets(data, years, colors) {
            return years.map((year, i) => ({
                label: `CYCLE ${year}`,
                data: data.map(d => d[`avg_${year}`]),
                backgroundColor: colors[i],
                borderColor: colors[i],
                borderWidth: 2
            }));
        }

        function updateInsights(data) {
            document.getElementById('totalZones').textContent = data.zone_data.filter(z => z.ZONE !== "UNKNOWN").length;
            document.getElementById('totalDistricts').textContent = data.district_data.length;
            
            const maxCutoff = Math.max(...data.district_data.map(d => Math.max(d.avg_2023, d.avg_2024, d.avg_2025)));
            document.getElementById('maxCutoff').textContent = maxCutoff.toFixed(1);
        }

        (async function() {
            const chartContainers = document.querySelectorAll('.chart-container canvas');
            const loadingElements = [];
            
            // Add loading indicators
            chartContainers.forEach(canvas => {
                const loading = createLoadingElement();
                canvas.parentNode.insertBefore(loading, canvas);
                loadingElements.push(loading);
                canvas.style.display = 'none';
            });

            try {
                const data = await fetchRegionalData();
                const years = [2023, 2024, 2025];
                const neonColors = [
                    ['rgba(0,255,255,0.7)', 'rgba(255,0,255,0.7)', 'rgba(255,255,0,0.7)'],
                    ['rgba(255,0,255,0.7)', 'rgba(0,255,136,0.7)', 'rgba(255,102,0,0.7)'],
                    ['rgba(255,255,0,0.7)', 'rgba(0,255,255,0.7)', 'rgba(255,0,255,0.7)'],
                    ['rgba(0,255,136,0.7)'],
                    ['rgba(255,102,0,0.7)', 'rgba(0,255,255,0.7)', 'rgba(255,0,255,0.7)']
                ];
                const sectionColors = ['#00ffff', '#ff00ff', '#ffff00', '#00ff88', '#ff6600'];

                // Remove loading indicators and show charts
                loadingElements.forEach(loading => loading.remove());
                chartContainers.forEach(canvas => canvas.style.display = 'block');

                // Area Type Chart
                if (data.area_type_data && data.area_type_data.length > 0) {
                    const areaLabels = data.area_type_data.map(d => `${d.AREA_TYPE} ZONE`);
                    const areaDatasets = prepareDatasets(data.area_type_data, years, neonColors[0]);
                    renderBarChart(
                        document.getElementById('areaTypeChart').getContext('2d'), 
                        areaLabels, 
                        areaDatasets, 
                        'Institution Node Analysis',
                        sectionColors[0]
                    );
                }

                // Zone Chart
                if (data.zone_data && data.zone_data.length > 0) {
                    const filteredZoneData = data.zone_data.filter(d => d.ZONE && d.ZONE !== "UNKNOWN");
                    const zoneLabels = filteredZoneData.map(d => `${d.ZONE} SECTOR`);
                    const zoneDatasets = years.map((year, i) => ({
                        label: `CYCLE ${year}`,
                        data: filteredZoneData.map(d => d[`avg_${year}`] || 0),
                        backgroundColor: neonColors[1][i],
                        borderColor: neonColors[1][i],
                        borderWidth: 2
                    }));
                    renderBarChart(
                        document.getElementById('zoneChart').getContext('2d'),
                        zoneLabels,
                        zoneDatasets,
                        'Zone Network Status',
                        sectionColors[1]
                    );
                }

                // District Chart
                if (data.district_data && data.district_data.length > 0) {
                    const districtLabels = data.district_data.map(d => `${d.DISTRICT} CMD`);
                    const districtDatasets = prepareDatasets(data.district_data, years, neonColors[2]);
                    renderBarChart(
                        document.getElementById('districtChart').getContext('2d'), 
                        districtLabels, 
                        districtDatasets, 
                        'District Command Centers',
                        sectionColors[2]
                    );
                }

                // Top Districts by Allotment Count
                if (data.top_district_counts && data.top_district_counts.length > 0) {
                    const topDistrictLabels = data.top_district_counts.map(d => `${d.DISTRICT} NODE`);
                    const topDistrictData = data.top_district_counts.map(d => d.allotment_count || 0);
                    renderBarChart(
                        document.getElementById('topDistrictChart').getContext('2d'), 
                        topDistrictLabels, 
                        [{ 
                            label: 'ALLOCATION COUNT', 
                            data: topDistrictData, 
                            backgroundColor: neonColors[3],
                            borderColor: neonColors[3][0],
                            borderWidth: 2
                        }], 
                        'Elite Districts Leaderboard',
                        sectionColors[3]
                    );
                }

                // District Trends Chart
                if (data.district_data && data.district_data.length > 0) {
                    const trendLabels = data.district_data.map(d => d.DISTRICT);
                    const trendDatasets = years.map((year, i) => ({
                        label: `CYCLE ${year}`,
                        data: data.district_data.map(d => d[`avg_${year}`] || 0),
                        borderColor: neonColors[4][i],
                        backgroundColor: neonColors[4][i] + '40',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        tension: 0.3,
                        fill: false
                    }));
                    renderLineChart(
                        document.getElementById('districtTrendChart').getContext('2d'),
                        trendLabels,
                        trendDatasets,
                        sectionColors[4]
                    );
                }

                // Update insights
                updateInsights(data);

                console.log('üéÆ NEURAL DASHBOARD ONLINE! All systems operational.');

            } catch (err) {
                console.error('üí• SYSTEM MALFUNCTION:', err);
                
                loadingElements.forEach((loading, index) => {
                    loading.innerHTML = `
                        <div class="error">
                            ‚ö† NEURAL LINK DISRUPTED ‚ö†<br>
                            Failed to connect to backend API<br>
                            <small>Error: ${err.message}</small><br>
                            <small>Check if /cutoff/regional-data endpoint is available</small>
                        </div>`;
                });

                // Hide chart canvases on error
                chartContainers.forEach(canvas => {
                    canvas.style.display = 'none';
                });
            }
        })();
    </script>
</body>
</html>